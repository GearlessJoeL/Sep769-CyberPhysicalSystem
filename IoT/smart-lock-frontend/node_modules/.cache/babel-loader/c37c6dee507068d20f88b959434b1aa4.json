{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState, useCallback, useEffect } from 'react';\nimport { usePubNub } from 'pubnub-react';\nimport { getChannel } from '../utils/pubnub-config';\nexport const useHistory = () => {\n  _s();\n  const pubnub = usePubNub();\n  const channel = getChannel();\n  const [history, setHistory] = useState([]);\n  const [logs, setLogs] = useState([]);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(null);\n  const fetchLogs = useCallback(async () => {\n    setLoading(true);\n    setError(null);\n    try {\n      const result = await pubnub.history({\n        channel: channel,\n        count: 100,\n        stringifiedTimeToken: true\n      });\n      const formattedLogs = result.messages.map(item => {\n        var _item$entry, _item$message, _item$entry2, _item$message2, _item$entry3, _item$message3, _item$entry4, _item$message4;\n        return {\n          id: item.timetoken,\n          timestamp: new Date(parseInt(item.timetoken / 10000)).toISOString(),\n          type: ((_item$entry = item.entry) === null || _item$entry === void 0 ? void 0 : _item$entry.type) || ((_item$message = item.message) === null || _item$message === void 0 ? void 0 : _item$message.type),\n          success: ((_item$entry2 = item.entry) === null || _item$entry2 === void 0 ? void 0 : _item$entry2.success) || ((_item$message2 = item.message) === null || _item$message2 === void 0 ? void 0 : _item$message2.success),\n          message: ((_item$entry3 = item.entry) === null || _item$entry3 === void 0 ? void 0 : _item$entry3.message) || ((_item$message3 = item.message) === null || _item$message3 === void 0 ? void 0 : _item$message3.message),\n          userId: ((_item$entry4 = item.entry) === null || _item$entry4 === void 0 ? void 0 : _item$entry4.userId) || ((_item$message4 = item.message) === null || _item$message4 === void 0 ? void 0 : _item$message4.userId),\n          ...(item.entry || item.message)\n        };\n      });\n      setLogs(formattedLogs);\n    } catch (error) {\n      setError('Failed to fetch access logs: ' + error.message);\n      console.error('Failed to fetch access logs:', error);\n    } finally {\n      setLoading(false);\n    }\n  }, [pubnub, channel]);\n  useEffect(() => {\n    const handleMessage = event => {\n      if (event.channel === channel && event.message.type === 'ACCESS_LOG') {\n        setLogs(prevLogs => [{\n          id: event.timetoken,\n          timestamp: new Date(parseInt(event.timetoken / 10000)).toISOString(),\n          ...event.message\n        }, ...prevLogs]);\n      }\n    };\n    pubnub.addListener({\n      message: handleMessage\n    });\n\n    // Initial fetch\n    fetchLogs();\n    return () => {\n      pubnub.removeListener({\n        message: handleMessage\n      });\n    };\n  }, [pubnub, fetchLogs, channel]);\n  const clearLogs = useCallback(() => {\n    setLogs([]);\n  }, []);\n  return {\n    logs,\n    loading,\n    error,\n    fetchLogs,\n    clearLogs\n  };\n};\n_s(useHistory, \"eBWtf+J3mW+H6Pdf9fV7bpZx/XU=\", false, function () {\n  return [usePubNub];\n});\nexport default useHistory;","map":{"version":3,"names":["useState","useCallback","useEffect","usePubNub","getChannel","useHistory","_s","pubnub","channel","history","setHistory","logs","setLogs","loading","setLoading","error","setError","fetchLogs","result","count","stringifiedTimeToken","formattedLogs","messages","map","item","_item$entry","_item$message","_item$entry2","_item$message2","_item$entry3","_item$message3","_item$entry4","_item$message4","id","timetoken","timestamp","Date","parseInt","toISOString","type","entry","message","success","userId","console","handleMessage","event","prevLogs","addListener","removeListener","clearLogs"],"sources":["/home/joel/code/Sep728/smart-lock-frontend/src/hooks/useHistory.js"],"sourcesContent":["import { useState, useCallback, useEffect } from 'react';\nimport { usePubNub } from 'pubnub-react';\nimport { getChannel } from '../utils/pubnub-config';\n\nexport const useHistory = () => {\n    const pubnub = usePubNub();\n    const channel = getChannel();\n    const [history, setHistory] = useState([]);\n    const [logs, setLogs] = useState([]);\n    const [loading, setLoading] = useState(false);\n    const [error, setError] = useState(null);\n\n    const fetchLogs = useCallback(async () => {\n        setLoading(true);\n        setError(null);\n        try {\n            const result = await pubnub.history({\n                channel: channel,\n                count: 100,\n                stringifiedTimeToken: true\n            });\n\n            const formattedLogs = result.messages.map(item => ({\n                id: item.timetoken,\n                timestamp: new Date(parseInt(item.timetoken / 10000)).toISOString(),\n                type: item.entry?.type || item.message?.type,\n                success: item.entry?.success || item.message?.success,\n                message: item.entry?.message || item.message?.message,\n                userId: item.entry?.userId || item.message?.userId,\n                ...(item.entry || item.message)\n            }));\n\n            setLogs(formattedLogs);\n        } catch (error) {\n            setError('Failed to fetch access logs: ' + error.message);\n            console.error('Failed to fetch access logs:', error);\n        } finally {\n            setLoading(false);\n        }\n    }, [pubnub, channel]);\n\n    useEffect(() => {\n        const handleMessage = (event) => {\n            if (event.channel === channel && event.message.type === 'ACCESS_LOG') {\n                setLogs(prevLogs => [{\n                    id: event.timetoken,\n                    timestamp: new Date(parseInt(event.timetoken / 10000)).toISOString(),\n                    ...event.message\n                }, ...prevLogs]);\n            }\n        };\n\n        pubnub.addListener({\n            message: handleMessage\n        });\n\n        // Initial fetch\n        fetchLogs();\n\n        return () => {\n            pubnub.removeListener({ message: handleMessage });\n        };\n    }, [pubnub, fetchLogs, channel]);\n\n    const clearLogs = useCallback(() => {\n        setLogs([]);\n    }, []);\n\n    return {\n        logs,\n        loading,\n        error,\n        fetchLogs,\n        clearLogs\n    };\n};\n\nexport default useHistory;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}